<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì¶”ì²œí•´ë“œë¦¬ë°</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="screen chat-screen">

    <!-- ìƒë‹¨ í—¤ë” -->
    <header class="chat-header">
      <a href="home.html" class="back">â€¹</a>
      <h1 class="chat-title">ì¶”ì²œí•´ë“œë¦¬ë°</h1>
    </header>

    <!-- ì±„íŒ… ì˜ì—­ -->
    <main class="chat-body" id="chat-body">
      <!-- ì²˜ìŒì— ë³´ì´ëŠ” ë´‡ ì¸ì‚¬ë§ -->
      <div class="chat-row bot">
        <div class="chat-bubble">
          ì•ˆë…•í•˜ì„¸ìš”! ğŸ˜Š ì €ëŠ” ë“œë¦¼ìš”ì˜ AI ì±—ë´‡<br />
          <b>ì¶”ì²œí•´ë“œë¦¬ë°</b> ì…ë‹ˆë‹¤.<br /><br />
          ê¸°ì°¨ ë§ˆì¼ë¦¬ì§€ë¡œ ê¸°ë¶€í•  ìˆ˜ ìˆëŠ” í’ˆëª©ì„<br />
          ì¶”ì²œí•´ë“œë¦´ê²Œìš”.<br />
          ë³´ìœ  í¬ì¸íŠ¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”!
        </div>
      </div>
    </main>

    <!-- í•˜ë‹¨ ì…ë ¥ì°½ -->
    <form class="chat-input-bar" id="chat-form">
      <input
        type="text"
        id="chat-input"
        class="chat-input"
        placeholder="ë³´ìœ  ë§ˆì¼ë¦¬ì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 5000)"
        autocomplete="off"
      />
      <button type="submit" class="chat-send-button">ì „ì†¡</button>
    </form>
  </div>

  <script>
    const chatBody = document.getElementById("chat-body");
    const chatForm = document.getElementById("chat-form");
    const chatInput = document.getElementById("chat-input");

    let actionsShown = false;   // ê¸°ë¶€í•˜ê¸°/ì¢…ë£Œí•˜ê¸° ë²„íŠ¼ ìƒì„± ì—¬ë¶€
    let optionsShown = false;   // í’ˆëª© ì„ íƒ ì˜µì…˜ ìƒì„± ì—¬ë¶€
    let selectedItem = null;    // ì„ íƒëœ í’ˆëª© ì´ë¦„
    let selectedAmount = 0;     // ì„ íƒëœ í’ˆëª© ê°€ê²©(P)

    // ê¸°ë³¸ ë§í’ì„  ì¶”ê°€
    function addBubble(text, type) {
      const row = document.createElement("div");
      row.className = "chat-row " + type;

      const bubble = document.createElement("div");
      bubble.className = "chat-bubble";
      bubble.innerHTML = text.replace(/\n/g, "<br />");

      row.appendChild(bubble);
      chatBody.appendChild(row);

      chatBody.scrollTop = chatBody.scrollHeight;
    }

    // ì¶”ì²œ ì¹´ë“œ ìŠ¤íƒ€ì¼ ë§í’ì„  ì¶”ê°€
    function addCardBubble(text) {
      const row = document.createElement("div");
      row.className = "chat-row bot";

      const bubble = document.createElement("div");
      bubble.className = "chat-bubble chat-bubble-card";
      bubble.innerHTML = text.replace(/\n/g, "<br />");

      row.appendChild(bubble);
      chatBody.appendChild(row);

      chatBody.scrollTop = chatBody.scrollHeight;
    }

    // í’ˆëª© ì„ íƒ ë²„íŠ¼ë“¤ ë³´ì—¬ì£¼ê¸°
    function showOptions() {
      if (optionsShown) return;
      optionsShown = true;

      const options = document.createElement("div");
      options.className = "chat-options";

      const items = [
        { label: "[ìƒí•„í’ˆ] GS25 ì¢‹ì€ëŠë‚Œ", price: 4000 },
        { label: "[ìŒë£Œ] ì´ë””ì•¼ì»¤í”¼ ì¹´í˜ëª¨ì¹´ R", price: 3500 },
        { label: "[ìŒë£Œ] ë”ë²¤í‹° ì•„ë©”ë¦¬ì¹´ë…¸", price: 3500 },
      ];

      items.forEach((item) => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "chat-option-button";
        btn.dataset.price = item.price;
        btn.dataset.label = item.label;

        const title = document.createElement("div");
        title.className = "chat-option-title";
        title.textContent = item.label;

        const price = document.createElement("div");
        price.className = "chat-option-price";
        price.textContent = item.price.toLocaleString() + "P";

        btn.appendChild(title);
        btn.appendChild(price);

        btn.onclick = () => {
          // ëª¨ë‘ ì„ íƒ í•´ì œ
          document
            .querySelectorAll(".chat-option-button")
            .forEach((el) => el.classList.remove("selected"));

          // ì´ ë²„íŠ¼ë§Œ ì„ íƒ í‘œì‹œ
          btn.classList.add("selected");

          selectedItem = item.label;
          selectedAmount = item.price;
        };

        options.appendChild(btn);
      });

      chatBody.appendChild(options);
      chatBody.scrollTop = chatBody.scrollHeight;
    }

    // ê¸°ë¶€í•˜ê¸° / ì¢…ë£Œí•˜ê¸° ë²„íŠ¼ ì˜ì—­ ì¶”ê°€
    function showActions() {
      if (actionsShown) return;
      actionsShown = true;

      const actions = document.createElement("div");
      actions.className = "chat-actions";

      const donateBtn = document.createElement("button");
      donateBtn.className = "chat-action-button";
      donateBtn.textContent = "ê¸°ë¶€í•˜ê¸°";

      // ğŸ‘‰ ê²°ì œ í˜ì´ì§€ë¡œ ì´ë™ (ì„ íƒ í’ˆëª©/ê¸ˆì•¡ ì €ì¥)
      donateBtn.onclick = () => {
        if (!selectedItem) {
          alert("ë¨¼ì € ê¸°ë¶€í•  í’ˆëª©ì„ í•˜ë‚˜ ì„ íƒí•´ ì£¼ì„¸ìš”!");
          return;
        }

        // ê²°ì œ í™”ë©´ì—ì„œ ì‚¬ìš©í•  ì •ë³´ ì €ì¥
        localStorage.setItem("donationItem", selectedItem);
        localStorage.setItem("donationAmount", String(selectedAmount));

        window.location.href = "payment.html";
      };

      const endBtn = document.createElement("button");
      endBtn.className = "chat-action-button chat-action-sub";
      endBtn.textContent = "ì¢…ë£Œí•˜ê¸°";
      endBtn.onclick = () => {
        window.location.href = "home.html";
      };

      actions.appendChild(donateBtn);
      actions.appendChild(endBtn);

      chatBody.appendChild(actions);
      chatBody.scrollTop = chatBody.scrollHeight;
    }

    // í¬ì¸íŠ¸ì— ë”°ë¼ ë´‡ ë‹µì¥ í…ìŠ¤íŠ¸ ë§Œë“¤ê¸°
    function getDemoReply(point) {
      return (
        `í˜„ì¬ <b>${point}í¬ì¸íŠ¸</b>ë¡œ ê¸°ë¶€ ê°€ëŠ¥í•œ í’ˆëª©ì´ì—ìš”.<br><br>` +
        `â€¢ [ìƒí•„í’ˆ] GS25 ì¢‹ì€ëŠë‚Œ (4,000P)<br>` +
        `â€¢ [ìŒë£Œ] ì´ë””ì•¼ì»¤í”¼ ì¹´í˜ëª¨ì¹´ R (3,500P)<br>` +
        `â€¢ [ìŒë£Œ] ë”ë²¤í‹° ì•„ë©”ë¦¬ì¹´ë…¸ (3,500P)<br><br>` +
        `ì›í•˜ëŠ” í’ˆëª©ì„ ê³¨ë¼ ì•„ì´ë“¤ì—ê²Œ ë”°ëœ»í•œ ì‘ì›ì„ ì „í•´ë³¼ê¹Œìš”? ğŸ˜Š`
      );
    }

    chatForm.addEventListener("submit", function (e) {
      e.preventDefault();
      const text = chatInput.value.trim();
      if (!text) return;

      // ì‚¬ìš©ì ë§í’ì„  ì¶”ê°€
      addBubble(text, "user");
      chatInput.value = "";

      // ìˆ«ì(í¬ì¸íŠ¸) ì¶”ì¶œ
      const num = text.match(/\d+/g);
      if (!num) {
        setTimeout(() => {
          addBubble(
            "ë³´ìœ  ë§ˆì¼ë¦¬ì§€ë¥¼ ìˆ«ìë¡œ ì…ë ¥í•´ ì£¼ë©´, ê¸°ë¶€ ê°€ëŠ¥í•œ í’ˆëª©ì„ ì¶”ì²œí•´ë“œë¦´ê²Œìš”! ì˜ˆ: 5000",
            "bot"
          );
        }, 500);
        return;
      }

      const point = num[0];

      // ì¶”ì²œ ì¹´ë“œ + í’ˆëª© ì„ íƒ + ë²„íŠ¼ì€ ì•½ê°„ ë”œë ˆì´ í›„ ë“±ì¥
      setTimeout(() => {
        const reply = getDemoReply(point);
        addCardBubble(reply);   // ì¹´ë“œí˜• ë§í’ì„ 
        showOptions();          // í’ˆëª© ì„ íƒ ë²„íŠ¼ë“¤
        showActions();          // ê¸°ë¶€í•˜ê¸°/ì¢…ë£Œí•˜ê¸° ë²„íŠ¼
      }, 600);
    });
  </script>
</body>
</html>
