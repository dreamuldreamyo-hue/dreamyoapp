<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì¶”ì²œí•´ë“œë¦¬ë°</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="screen chat-screen">

    <!-- ìƒë‹¨ í—¤ë” -->
    <header class="chat-header">
      <a href="home.html" class="back">â€¹</a>
      <h1 class="chat-title">ì¶”ì²œí•´ë“œë¦¬ë°</h1>
    </header>

    <!-- ì±„íŒ… ì˜ì—­ -->
    <main class="chat-body" id="chat-body">
      <!-- ì²˜ìŒì— ë³´ì´ëŠ” ë´‡ ì¸ì‚¬ë§ -->
      <div class="chat-row bot">
        <div class="chat-bubble">
          ì•ˆë…•í•˜ì„¸ìš”! ğŸ˜Š ì €ëŠ” ë“œë¦¼ìš”ì˜ AI ì±—ë´‡<br />
          <b>ì¶”ì²œí•´ë“œë¦¬ë°</b> ì…ë‹ˆë‹¤.<br /><br />
          ê¸°ì°¨ ë§ˆì¼ë¦¬ì§€ë¡œ ê¸°ë¶€í•  ìˆ˜ ìˆëŠ” í’ˆëª©ì„<br />
          ì¶”ì²œí•´ë“œë¦´ê²Œìš”.<br />
          ë³´ìœ  í¬ì¸íŠ¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”!
        </div>
      </div>
    </main>

    <!-- í•˜ë‹¨ ì…ë ¥ì°½ -->
    <form class="chat-input-bar" id="chat-form">
      <input
        type="text"
        id="chat-input"
        class="chat-input"
        placeholder="ë³´ìœ  ë§ˆì¼ë¦¬ì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 5000)"
        autocomplete="off"
      />
      <button type="submit" class="chat-send-button">ì „ì†¡</button>
    </form>
  </div>

  <script>
    const chatBody = document.getElementById("chat-body");
    const chatForm = document.getElementById("chat-form");
    const chatInput = document.getElementById("chat-input");

    let actionsShown = false; // ê¸°ë¶€í•˜ê¸°/ì¢…ë£Œí•˜ê¸° ë²„íŠ¼ì´ ì´ë¯¸ ë§Œë“¤ì–´ì¡ŒëŠ”ì§€ ì—¬ë¶€

    // ê¸°ë³¸ ë§í’ì„  ì¶”ê°€
    function addBubble(text, type) {
      const row = document.createElement("div");
      row.className = "chat-row " + type;

      const bubble = document.createElement("div");
      bubble.className = "chat-bubble";
      bubble.innerHTML = text.replace(/\n/g, "<br />");

      row.appendChild(bubble);
      chatBody.appendChild(row);

      chatBody.scrollTop = chatBody.scrollHeight;
    }

    // ì¶”ì²œ ì¹´ë“œ ìŠ¤íƒ€ì¼ ë§í’ì„  ì¶”ê°€
    function addCardBubble(text) {
      const row = document.createElement("div");
      row.className = "chat-row bot";

      const bubble = document.createElement("div");
      bubble.className = "chat-bubble chat-bubble-card";
      bubble.innerHTML = text.replace(/\n/g, "<br />");

      row.appendChild(bubble);
      chatBody.appendChild(row);

      chatBody.scrollTop = chatBody.scrollHeight;
    }

    // ê¸°ë¶€í•˜ê¸° / ì¢…ë£Œí•˜ê¸° ë²„íŠ¼ ì˜ì—­ ì¶”ê°€
    function showActions() {
      if (actionsShown) return;
      actionsShown = true;

      const actions = document.createElement("div");
      actions.className = "chat-actions";

      const donateBtn = document.createElement("button");
      donateBtn.className = "chat-action-button";
      donateBtn.textContent = "ê¸°ë¶€í•˜ê¸°";
      // ğŸ‘‰ ê²°ì œ í˜ì´ì§€ë¡œ ì´ë™
      donateBtn.onclick = () => {
        window.location.href = "payment.html";
      };

      const endBtn = document.createElement("button");
      endBtn.className = "chat-action-button chat-action-sub";
      endBtn.textContent = "ì¢…ë£Œí•˜ê¸°";
      endBtn.onclick = () => {
        // ì¼ë‹¨ì€ í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
        window.location.href = "home.html";
      };

      actions.appendChild(donateBtn);
      actions.appendChild(endBtn);

      chatBody.appendChild(actions);
      chatBody.scrollTop = chatBody.scrollHeight;
    }

    // í¬ì¸íŠ¸ì— ë”°ë¼ ë´‡ ë‹µì¥ í…ìŠ¤íŠ¸ ë§Œë“¤ê¸°
    function getDemoReply(point) {
      return (
        `í˜„ì¬ <b>${point}í¬ì¸íŠ¸</b>ë¡œ ê¸°ë¶€ ê°€ëŠ¥í•œ í’ˆëª©ì´ì—ìš”.<br><br>` +
        `â€¢ [ìƒí•„í’ˆ] GS25 ì¢‹ì€ëŠë‚Œ (4,000P)<br>` +
        `â€¢ [ìŒë£Œ] ì´ë””ì•¼ì»¤í”¼ ì¹´í˜ëª¨ì¹´ R (3,500P)<br>` +
        `â€¢ [ìŒë£Œ] ë”ë²¤í‹° ì•„ë©”ë¦¬ì¹´ë…¸ (3,500P)<br><br>` +
        `ì›í•˜ëŠ” í’ˆëª©ì„ ê³¨ë¼ ì•„ì´ë“¤ì—ê²Œ ì‘ì›ì„ ì „í•´ë³¼ê¹Œìš”? ğŸ˜Š`
      );
    }

    chatForm.addEventListener("submit", function (e) {
      e.preventDefault();
      const text = chatInput.value.trim();
      if (!text) return;

      // ì‚¬ìš©ì ë§í’ì„  ì¶”ê°€
      addBubble(text, "user");
      chatInput.value = "";

      // ìˆ«ì(í¬ì¸íŠ¸) ì¶”ì¶œ
      const num = text.match(/\d+/g);
      if (!num) {
        setTimeout(() => {
          addBubble(
            "ë³´ìœ  ë§ˆì¼ë¦¬ì§€ë¥¼ ìˆ«ìë¡œ ì…ë ¥í•´ ì£¼ë©´, ê¸°ë¶€ ê°€ëŠ¥í•œ í’ˆëª©ì„ ì¶”ì²œí•´ë“œë¦´ê²Œìš”! ì˜ˆ: 5000",
            "bot"
          );
        }, 500);
        return;
      }

      const point = num[0];

      // ğŸ‘‰ ì‚¬ìš©ìê°€ ì…ë ¥í•œ í¬ì¸íŠ¸ë¥¼ ì €ì¥ (ê²°ì œ í™”ë©´ì—ì„œ ê°€ì ¸ë‹¤ ì”€)
      localStorage.setItem("donationAmount", point);

      // ì¶”ì²œ ì¹´ë“œ + ë²„íŠ¼ì€ ì•½ê°„ ë”œë ˆì´ í›„ ë“±ì¥
      setTimeout(() => {
        const reply = getDemoReply(point);
        addCardBubble(reply);  // ì¹´ë“œí˜• ë§í’ì„ 
        showActions();         // ë²„íŠ¼ ë‘ ê°œ ìƒì„±
      }, 600);
    });
  </script>
</body>
</html>
