<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>μ‚¬μ¤„κ²μ” - κ²°μ </title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="screen payment-screen">
    <!-- μƒλ‹¨ ν—¤λ” -->
    <header class="payment-header">
      <a href="recommend.html" class="back">β€Ή</a>
      <h1 class="payment-title">μ‚¬μ¤„κ²μ”</h1>
    </header>

    <!-- λ³Έλ¬Έ -->
    <main class="payment-body">
      <!-- μ£Όλ¬Έ μ”μ•½ μΉ΄λ“ -->
      <section class="pay-card order-card">
        <div class="card-title">μ£Όλ¬Έ μ”μ•½</div>

        <div class="order-row">
          <span class="order-label">μμ‹μ </span>
          <span class="order-value">λ§μ¤ν„°μΉ</span>
        </div>
        <div class="order-row">
          <span class="order-label">λ©”λ‰΄</span>
          <span class="order-value">ν΄λ”μ¤νμ΄μ‹ λ²„κ±° μ„ΈνΈ</span>
        </div>

        <div class="order-row order-total">
          <span class="order-label">μ΄ κΈμ•΅</span>
          <span class="order-total-value" id="pay-total">0μ›</span>
        </div>
      </section>

      <!-- μ½”λ μΌ λ§μΌλ¦¬μ§€ μΉ΄λ“ -->
      <section class="pay-card mileage-card">
        <div class="order-row">
          <span class="order-label">μ½”λ μΌ λ§μΌλ¦¬μ§€</span>
          <span class="mileage-value" id="pay-mileage">0P</span>
        </div>
        <button type="button" class="mileage-detail-row">
          <span>μ λ¦½ λ‚΄μ—­ λ³΄κΈ°</span>
          <span>β€Ί</span>
        </button>
      </section>

      <!-- κ²°μ  μλ‹¨ μΉ΄λ“ -->
      <section class="pay-card method-card">
        <div class="card-title">κ²°μ  μλ‹¨</div>

        <div class="pay-method-list" id="pay-method-list">
          <!-- μ‹ μ©μΉ΄λ“ -->
          <button type="button" class="pay-method-option selected" data-method="μ‹ μ©μΉ΄λ“">
            <div class="pay-method-main">
              <div class="pay-method-icon">π’³</div>
              <div class="pay-method-text">
                <div class="pay-method-name">μ‹ μ©μΉ΄λ“</div>
                <div class="pay-method-sub">μΌμ‹λ¶ / ν• λ¶€ κ²°μ </div>
              </div>
            </div>
            <div class="pay-method-check">β”</div>
          </button>

          <!-- μΉ΄μΉ΄μ¤νμ΄ -->
          <button type="button" class="pay-method-option" data-method="μΉ΄μΉ΄μ¤νμ΄">
            <div class="pay-method-main">
              <div class="pay-method-icon">π΅</div>
              <div class="pay-method-text">
                <div class="pay-method-name">μΉ΄μΉ΄μ¤νμ΄</div>
                <div class="pay-method-sub">μΉ΄μΉ΄μ¤ν†΅ κ°„νΈκ²°μ </div>
              </div>
            </div>
          </button>

          <!-- λ„¤μ΄λ²„νμ΄ -->
          <button type="button" class="pay-method-option" data-method="λ„¤μ΄λ²„νμ΄">
            <div class="pay-method-main">
              <div class="pay-method-icon">πΆ</div>
              <div class="pay-method-text">
                <div class="pay-method-name">λ„¤μ΄λ²„νμ΄</div>
                <div class="pay-method-sub">ν¬μΈνΈ μ λ¦½ κ°€λ¥</div>
              </div>
            </div>
          </button>

          <!-- ν† μ¤νμ΄ -->
          <button type="button" class="pay-method-option" data-method="ν† μ¤νμ΄">
            <div class="pay-method-main">
              <div class="pay-method-icon">π’™</div>
              <div class="pay-method-text">
                <div class="pay-method-name">ν† μ¤νμ΄</div>
                <div class="pay-method-sub">κ°„νΈ μ†΅κΈ κ²°μ </div>
              </div>
            </div>
          </button>

          <!-- λ§μΌλ¦¬μ§€ μ‚¬μ© -->
          <div class="pay-mileage-use">
            <div class="pay-mileage-use-header">
              <span class="pay-method-name">λ§μΌλ¦¬μ§€ μ‚¬μ©</span>
            </div>
            <div class="pay-mileage-use-body">
              <div class="pay-mileage-input-row">
                <span class="pay-mileage-label">λ§μΌλ¦¬μ§€</span>
                <input
                  type="number"
                  id="mileage-input"
                  class="pay-mileage-input"
                  min="0"
                  value="0"
                />
                <span class="pay-mileage-unit">P</span>
                <button type="button" class="pay-mileage-all" id="mileage-all">
                  λ¨λ‘ μ‚¬μ©
                </button>
              </div>
              <div class="pay-mileage-bar">
                <div class="pay-mileage-bar-fill" id="mileage-bar-fill"></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- μ‘μ› λ©”μ‹μ§€ μΉ΄λ“ -->
      <section class="pay-card message-card">
        <div class="card-title">μ‘μ› λ©”μ‹μ§€ (μ„ νƒ)</div>
        <textarea
          class="message-textarea"
          id="support-message"
          placeholder="λ”°λ»ν• μ‘μ› λ©”μ„Έμ§€λ¥Ό λ‚¨κ²¨μ£Όμ„Έμ”"
        ></textarea>
      </section>
    </main>

    <!-- ν•λ‹¨ κ²°μ  λ²„νΌ -->
    <button class="payment-submit-button" id="payment-submit">
      <span id="payment-submit-label">0μ› κ²°μ </span>
    </button>
  </div>

  <script>
    // --- 1. μ¶”μ²ν•΄λ“λ¦¬λ°μ—μ„ κ°€μ Έμ¨ κΈμ•΅ μ„Έν… ---
    const storedAmount = localStorage.getItem("donationAmount") || "0";
    const amount = parseInt(storedAmount, 10) || 0;

    function formatNumber(num) {
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    const payTotalEl = document.getElementById("pay-total");
    const payMileageEl = document.getElementById("pay-mileage");
    const payButtonLabel = document.getElementById("payment-submit-label");
    const mileageInput = document.getElementById("mileage-input");
    const mileageAllBtn = document.getElementById("mileage-all");
    const mileageBarFill = document.getElementById("mileage-bar-fill");

    payTotalEl.textContent = formatNumber(amount) + "μ›";
    payMileageEl.textContent = formatNumber(amount) + "P";
    payButtonLabel.textContent = formatNumber(amount) + "μ› κ²°μ ";
    mileageInput.max = amount;
    mileageInput.value = 0;
    mileageBarFill.style.width = "0%";

    function updateMileageBar() {
      const used = parseInt(mileageInput.value || "0", 10);
      const ratio = amount > 0 ? Math.min(used / amount, 1) : 0;
      mileageBarFill.style.width = ratio * 100 + "%";
    }

    mileageInput.addEventListener("input", () => {
      if (parseInt(mileageInput.value || "0", 10) > amount) {
        mileageInput.value = amount;
      }
      updateMileageBar();
    });

    mileageAllBtn.addEventListener("click", () => {
      mileageInput.value = amount;
      updateMileageBar();
    });

    // --- 2. κ²°μ  μλ‹¨ μ„ νƒ ---
    const methodList = document.getElementById("pay-method-list");
    let selectedMethod = "μ‹ μ©μΉ΄λ“";

    methodList.addEventListener("click", (e) => {
      const option = e.target.closest(".pay-method-option");
      if (!option) return;

      // λ¨λ“  μ„ νƒ ν•΄μ 
      document
        .querySelectorAll(".pay-method-option")
        .forEach((el) => el.classList.remove("selected"));

      // μ„ νƒλ κ²ƒλ§ ν‘μ‹
      option.classList.add("selected");
      selectedMethod = option.dataset.method || "μ‹ μ©μΉ΄λ“";
    });

    // --- 3. κ²°μ  λ²„νΌ λ™μ‘ (λ°λ¨μ©) ---
    const submitBtn = document.getElementById("payment-submit");

    submitBtn.addEventListener("click", () => {
      const usedMileage = parseInt(mileageInput.value || "0", 10);
      const finalAmount = Math.max(amount - usedMileage, 0);

      alert(
        "ν•΄μ»¤ν†¤ λ°λ¨μ© κ²°μ μ…λ‹λ‹¤.\n\n" +
          "κ²°μ  μλ‹¨: " +
          selectedMethod +
          "\n" +
          "μ΄ κΈμ•΅: " +
          formatNumber(amount) +
          "μ›\n" +
          "μ‚¬μ© λ§μΌλ¦¬μ§€: " +
          formatNumber(usedMileage) +
          "P\n" +
          "μ‹¤μ  κ²°μ  κΈμ•΅(λ§μΌλ¦¬μ§€ μ°¨κ° ν›„): " +
          formatNumber(finalAmount) +
          "μ›\n\n" +
          "μ‹¤μ  κ²°μ λ” μ΄λ£¨μ–΄μ§€μ§€ μ•μµλ‹λ‹¤."
      );

      // λ°λ¨μ©: κ²°μ  ν›„ ν™μΌλ΅ μ΄λ™
      window.location.href = "home.html";
    });
  </script>
</body>
</html>
